<?phpinclude('../modules/site.php');include('../header.php');$id = isset($_COOKIE['id']) ? $_COOKIE['id'] : '';// Récupération des sous-dossiers disponibles$uploadBaseDir = 'uploads/';$subdirectories = array_filter(scandir($uploadBaseDir), function($item) use ($uploadBaseDir) {    return is_dir($uploadBaseDir . $item) && !in_array($item, ['.', '..', 'indexfiles', 'delete']);});// Traitement de l'uploadif (isset($_FILES['monfichier']) && $_FILES['monfichier']['error'] == 0) {    $selectedDir = $_POST['subdirectory'] ?? '';        if (in_array($selectedDir, $subdirectories)) {        $targetDir = $uploadBaseDir . $selectedDir . '/';                if ($_FILES['monfichier']['size'] <= 1000000000) { // 1 Go max            $infosfichier = pathinfo($_FILES['monfichier']['name']);            $extension_upload = strtolower($infosfichier['extension']);            $extensions_autorisees = ['jpg', 'jpeg', 'gif', 'png', 'exe', 'py', 'bat', 'pdf', 'odt', 'vbs', 'html', 'php', 'css', 'bmp', 'avi', 'mp4', 'skp', 'odp', 'docx', 'txt'];                        if (in_array($extension_upload, $extensions_autorisees)) {                $baseName = basename($_FILES['monfichier']['name']);                $fileName = pathinfo($baseName, PATHINFO_FILENAME);                $fileExtension = pathinfo($baseName, PATHINFO_EXTENSION);                                // Génération d'un nom unique                $counter = 1;                while(file_exists($targetDir . $baseName)) {                    $baseName = "{$fileName}_{$counter}.{$fileExtension}";                    $counter++;                }                                if (move_uploaded_file($_FILES['monfichier']['tmp_name'], $targetDir . $baseName)) {                    $message = "Fichier uploadé avec succès dans : $selectedDir/";                } else {                    $message = "Erreur lors de l'upload du fichier";                }            } else {                $message = "Extension de fichier non autorisée";            }        } else {            $message = "Fichier trop volumineux (max 1 Go)";        }    } else {        $message = "Sous-dossier invalide";    }}?><!DOCTYPE html><html lang="fr"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Ajout de fichier</title></head><body>    <div class="container">        <h1>Ajout de fichier</h1>        <?php if (isset($message)): ?>            <div class="message"><?= htmlspecialchars($message) ?></div>        <?php endif; ?>        <form action="" method="post" enctype="multipart/form-data">            <div class="form-group">                <label for="subdirectory">Sélectionnez un dossier :</label>                <select name="subdirectory" id="subdirectory" required>                    <?php foreach($subdirectories as $dir): ?>                        <option value="<?= htmlspecialchars($dir) ?>"><?= htmlspecialchars($dir) ?></option>                    <?php endforeach; ?>                </select>            </div>            <div class="form-group">                <label>Fichier à uploader :</label>                <input type="file" name="monfichier" required />            </div>            <input type="submit" value="Envoyer le fichier" />        </form>        <?php            include('footer.php');        ?>    </div></body></html>