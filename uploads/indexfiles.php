<?phpinclude('../modules/site.php');include('../header.php');$id = isset($_COOKIE['id']) ? $_COOKIE['id'] : '';function getSecureSubdirectories($baseDir) {    $dirs = array_filter(glob($baseDir . '*'), 'is_dir');    $secureDirs = [];    foreach ($dirs as $dir) {        $dirName = basename($dir);        if ($dirName !== '.' && $dirName !== '..') {            $secureDirs[] = $dirName;        }    }    return $secureDirs;}$baseDir = "./uploads/";$subdirectories = getSecureSubdirectories($baseDir);$selectedDir = isset($_GET['dir']) ? $_GET['dir'] : '';if (!in_array($selectedDir, $subdirectories)) {    $selectedDir = $subdirectories[0] ?? '';}?><!DOCTYPE html><html lang="fr"><head>    <meta charset="UTF-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Liste des fichiers</title></head><body>    <div class="container">        <h1>Liste des fichiers</h1>                <form id="dirForm">            <select name="dir" onchange="this.form.submit()">                <?php foreach ($subdirectories as $dir): ?>                    <option value="<?= htmlspecialchars($dir) ?>" <?= $dir === $selectedDir ? 'selected' : '' ?>>                        <?= htmlspecialchars($dir) ?>                    </option>                <?php endforeach; ?>            </select>        </form>        <div class="file-list">            <?php            $currentDir = $baseDir . $selectedDir;            if (is_dir($currentDir)) {                $files = scandir($currentDir);                foreach ($files as $file) {                    if ($file !== '..' && $file !== '.' && $file !== 'index.php' && $file !== 'download') {                        $filePath = $currentDir . '/' . $file;                        if (is_file($filePath)) {                            $downloadPath = $site . "/uploads/download.php?file=" . urlencode($selectedDir . '/' . $file);                            echo "<div class='file-item'>";                            echo "<div class='file-name'>" . htmlspecialchars($file) . "</div>";                            echo "<a href='{$downloadPath}' class='button'>Télécharger</a>";                            echo "<button onclick='copyToClipboard(\"" . $downloadPath . "\")' class='button'>Copier le chemin</button>";                            echo "</div>";                        }                    }                }            } else {                echo "Le dossier sélectionné n'existe pas.";            }            ?>        </div>        <?php            include('footer.php');        ?>    <script>    function copyToClipboard(text) {        navigator.clipboard.writeText(text).then(function() {            alert('Chemin d\'accès copié !');        }, function(err) {            console.error('Erreur lors de la copie : ', err);        });    }    </script></body></html>